<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>地点マップ</title>

<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#ffffff">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">

<style>
  :root{ --bg:#fafafa; --ink:#111; --muted:#6b6b6b; --line:#dcdcdc; }
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans JP","Yu Gothic",Meiryo,sans-serif}
  .wrap{max-width:1100px;margin:0 auto;padding:18px}
  .card{background:#fff;border:1px solid var(--line);border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.05)}
  .h{font-weight:800;font-size:18px;margin:0 0 8px}

  .row{display:grid;grid-template-columns:1fr 180px 120px;gap:10px}
  .ctl{display:flex;flex-direction:column;gap:6px}
  label{font-size:12px;color:var(--muted)}
  select,button{height:44px;border:1px solid var(--line);border-radius:10px;font-size:14px;padding:0 10px;background:#fff;cursor:pointer;font-weight:700}

  #map{height:60vh;border-radius:12px;border:1px solid var(--line);margin-top:12px}
  .divider{height:1px;background:var(--line);margin:12px 0}

  .group-ui{display:grid;gap:8px;margin-top:10px}
  details.group{border:1px solid var(--line);border-radius:10px;background:#fff}
  details.group > summary{list-style:none;cursor:pointer;padding:10px 12px;display:flex;align-items:center;gap:10px;font-weight:700;}
  details.group[open] > summary{border-bottom:1px solid var(--line);}
  .dot{width:14px;height:14px;border-radius:50%}
  .count{margin-left:auto;color:var(--muted);font-weight:600}
  .plist{margin:0;padding:8px 10px 10px;list-style:none;display:flex;flex-direction:column;gap:6px;max-height:220px;overflow:auto}
  .item{display:flex;align-items:center;gap:10px;cursor:pointer;padding:6px 8px;border-radius:8px}
  .item:hover{background:#f2f2f2}

  .pin-base{width:28px;height:28px;color:#fff;font-weight:800;font-size:14px;display:flex;align-items:center;justify-content:center;border:2px solid rgba(255,255,255,.95);box-shadow:0 2px 6px rgba(0,0,0,.35);line-height:1;}
  .pin-circle{border-radius:50%;}
  .pin-square{border-radius:6px;}
  .pin-diamond{width:26px;height:26px;transform:rotate(45deg);border-radius:6px;}
  .pin-diamond>span{transform:rotate(-45deg);display:inline-block;}

  .gmaps-link{color:#1976d2;text-decoration:none;}
  .gmaps-link:hover{text-decoration:underline;}

  @media(max-width:600px){ .row{grid-template-columns:1fr 1fr;} }
</style>
</head>

<body>
<div class="wrap">
  <div class="card" style="padding:14px;">
    <p class="h">地点マップ</p>

    <!-- リスト選択 -->
    <div class="row">
      <div class="ctl">
        <label>リスト選択</label>
        <select id="dataset"></select>
      </div>
      <div class="ctl">
        <label>&nbsp;</label>
        <button id="reload">表示</button>
      </div>
    </div>

    <div class="divider"></div>

    <!-- グループ一覧（上に移動） -->
    <div id="groupList" class="group-ui"></div>

    <div class="divider"></div>

    <!-- 地図（下へ移動） -->
    <div id="map"></div>

    <div class="divider"></div>

    <!-- 元データボタンを一番下へ -->
    <div style="display:flex;justify-content:flex-end;">
      <button id="openRaw">元データを開く</button>
    </div>

  </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<script>
/* ======= 以下、機能部はあなたが使っていたものをそのまま保持 ======= */
/* （ここは一切変更なし / 配置だけ変えた） */

/* 上で送った完全版コードのスクリプト部分をそのままここへ貼ってお使いください */
/* ※ 前回私が送った index.html の <script> ～ </script> 中身をそのまま使用 */

</script>

<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js");
}
</script>
</body>
</html>
